# Shannon ä¸­çš„ Python ä»£ç æ‰§è¡Œ

## æ¦‚è¿°

Shannon é€šè¿‡ WebAssembly ç³»ç»Ÿæ¥å£ï¼ˆWASIï¼‰æä¾›å®‰å…¨çš„ Python ä»£ç æ‰§è¡Œï¼Œç¡®ä¿å®Œæ•´çš„æ²™ç®±éš”ç¦»å’Œèµ„æºç®¡ç†ã€‚æœ¬æ–‡æ¡£æ¶µç›– Python æ‰§è¡Œç³»ç»Ÿçš„è®¾ç½®ã€ä½¿ç”¨å’Œæ¶æ„ã€‚

## å…³é”®è®¾ç½®è¦æ±‚ âš ï¸

### å‰ææ¡ä»¶ - å¯åŠ¨å‰å¿…é¡»å®Œæˆ

#### 1. ä¸‹è½½ Python WASI è§£é‡Šå™¨ï¼ˆå¿…éœ€ï¼‰

```bash
# åœ¨å¯åŠ¨æœåŠ¡ä¹‹å‰å¿…é¡»è¿è¡Œæ­¤å‘½ä»¤
./scripts/setup_python_wasi.sh

# éªŒè¯æ–‡ä»¶å·²ä¸‹è½½ï¼ˆåº”çº¦ 20MBï¼‰
ls -lh wasm-interpreters/python-3.11.4.wasm
```

#### 2. ç†è§£ WebAssembly è¡¨é™åˆ¶

**é‡è¦æç¤º**ï¼š"è¡¨é™åˆ¶"æ˜¯ WebAssembly è¿è¡Œæ—¶æ¦‚å¿µï¼š

- **WebAssembly è¡¨**ï¼šå­˜å‚¨ WASM æ¨¡å—ä¸­å‡½æ•°å¼•ç”¨çš„å†…å­˜ç»“æ„
- **Python éœ€è¦å¤§è¡¨**ï¼šCPython æœ‰æ•°åƒä¸ªå†…éƒ¨å‡½æ•°ï¼ˆ5413+ æ¡ç›®ï¼‰
- **é»˜è®¤é™åˆ¶**ï¼šé»˜è®¤åº”è¶…è¿‡ 5000+ï¼ŒPython éœ€è¦ 10000+

#### 3. å¿…éœ€çš„é…ç½®æ›´æ”¹

å¿…é¡»åœ¨ `rust/agent-core/src/wasi_sandbox.rs` ä¸­é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

```rust
// åœ¨ WasiSandbox::with_config() ä¸­
execution_timeout: app_config.wasi_timeout(),
// Python WASM éœ€è¦æ›´å¤§çš„è¡¨é™åˆ¶ï¼ˆ5413+ å…ƒç´ ï¼‰
table_elements_limit: 10000,  // å…³é”®ï¼šé»˜è®¤ 1024 å¤ªå°ï¼
instances_limit: 10,           // éœ€è¦å¤šä¸ª WASM å®ä¾‹
tables_limit: 10,              // å¤šä¸ªå‡½æ•°è¡¨
memories_limit: 4,             // å†…å­˜åŒºåŸŸ
```

#### 4. æ„å»ºå¹¶å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨é…ç½®æ›´æ”¹é‡æ–°æ„å»º agent-core
docker compose -f deploy/compose/docker-compose.yml build --no-cache agent-core

# é‡æ–°æ„å»º llm-service ä»¥åŒ…å« Python æ‰§è¡Œå™¨
docker compose -f deploy/compose/docker-compose.yml build llm-service

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
make dev
```

## å¿«é€Ÿå¼€å§‹ï¼ˆå®Œæˆè®¾ç½®åï¼‰

### 2. æ‰§è¡Œ Python ä»£ç 

```bash
# ç®€å•æ‰§è¡Œ
./scripts/submit_task.sh "æ‰§è¡Œ Python: print('ä½ å¥½ï¼ŒShannonï¼')"

# æ•°å­¦è®¡ç®—
./scripts/submit_task.sh "æ‰§è¡Œ Python ä»£ç è®¡ç®— 10 çš„é˜¶ä¹˜"
# æˆ–æ›´ç›´æ¥ï¼š
./scripts/submit_task.sh "è¿è¡Œ Python ä»£ç è®¡ç®— 10 çš„é˜¶ä¹˜"

# æ•°æ®å¤„ç†
./scripts/submit_task.sh "ä½¿ç”¨ Python ç”Ÿæˆå‰ 20 ä¸ªæ–æ³¢é‚£å¥‘æ•°"
```

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·è¯·æ±‚                              â”‚
â”‚           "æ‰§è¡Œ Python: print(2+2)"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç¼–æ’å™¨ (Go)                               â”‚
â”‚    æ ¹æ®å¤æ‚åº¦è·¯ç”±åˆ° LLM æœåŠ¡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                LLM æœåŠ¡ (Python)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         PythonWasiExecutorTool                   â”‚    â”‚
â”‚  â”‚  â€¢ æ£€æµ‹ Python æ‰§è¡Œéœ€æ±‚                          â”‚    â”‚
â”‚  â”‚  â€¢ å‡†å¤‡æ‰§è¡Œä¸Šä¸‹æ–‡                                â”‚    â”‚
â”‚  â”‚  â€¢ ç®¡ç†ä¼šè¯çŠ¶æ€ï¼ˆå¯é€‰ï¼‰                          â”‚    â”‚
â”‚  â”‚  â€¢ ç¼“å­˜è§£é‡Šå™¨ä»¥æé«˜æ€§èƒ½                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Agent Core (Rust)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          WASI æ²™ç®± (Wasmtime)                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚    Python.wasm (CPython 3.11.4)            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ å®Œæ•´æ ‡å‡†åº“                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ å†…å­˜é™åˆ¶ï¼š256MB                         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ CPU é™åˆ¶ï¼šå¯é…ç½®                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ è¶…æ—¶ï¼š30 ç§’ï¼ˆæœ€å¤§ 60 ç§’ï¼‰               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ æ— ç½‘ç»œè®¿é—®                              â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ åªè¯»æ–‡ä»¶ç³»ç»Ÿ                            â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½ç‰¹æ€§

### âœ… ç”Ÿäº§çº§åŠŸèƒ½

- **å®Œæ•´çš„ Python æ ‡å‡†åº“**ï¼šå®Œæ•´çš„ CPython 3.11.4 åŠæ‰€æœ‰å†…ç½®æ¨¡å—
- **ä¼šè¯æŒä¹…åŒ–**ï¼šä½¿ç”¨ä¼šè¯ ID è·¨æ‰§è¡Œç»´æŠ¤å˜é‡
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç¼“å­˜è§£é‡Šå™¨å°†å¯åŠ¨æ—¶é—´ä» 500ms å‡å°‘åˆ° 50ms
- **èµ„æºé™åˆ¶**ï¼šå¯é…ç½®çš„å†…å­˜ã€CPU å’Œè¶…æ—¶é™åˆ¶
- **å®‰å…¨éš”ç¦»**ï¼šé€šè¿‡ WASI å®ç°çœŸæ­£çš„æ²™ç®± - æ— ç½‘ç»œã€æ— æ–‡ä»¶ç³»ç»Ÿå†™å…¥
- **è¾“å‡ºæµå¼ä¼ è¾“**ï¼šé•¿æ—¶é—´è¿è¡Œè®¡ç®—çš„æ¸è¿›å¼è¾“å‡º
- **é”™è¯¯å¤„ç†**ï¼šå…¨é¢çš„é”™è¯¯æ¶ˆæ¯å’Œè¶…æ—¶ä¿æŠ¤

### ğŸš€ é«˜çº§èƒ½åŠ›

- **æŒä¹…ä¼šè¯**ï¼šå˜é‡å’Œå¯¼å…¥åœ¨æ‰§è¡Œé—´æŒä¹…åŒ–
- **è‡ªå®šä¹‰è¶…æ—¶**ï¼šæ¯æ¬¡æ‰§è¡Œå¯ä» 1 åˆ° 60 ç§’è°ƒæ•´
- **æ ‡å‡†è¾“å…¥æ”¯æŒ**ï¼šå‘ Python è„šæœ¬æä¾›è¾“å…¥æ•°æ®
- **æ€§èƒ½æŒ‡æ ‡**ï¼šæ‰§è¡Œæ—¶é—´è·Ÿè¸ªå’ŒæŠ¥å‘Š

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ Python æ‰§è¡Œ

```python
# è¯·æ±‚
"æ‰§è¡Œ Python: print('ä½ å¥½ï¼Œä¸–ç•Œï¼')"

# è¾“å‡º
ä½ å¥½ï¼Œä¸–ç•Œï¼
```

### æ•°å­¦è®¡ç®—

```python
# è¯·æ±‚
"æ‰§è¡Œ Python ä»£ç è®¡ç®— 10 çš„é˜¶ä¹˜"

# ç”Ÿæˆçš„ä»£ç 
import math
result = math.factorial(10)
print(f"10! = {result}")

# è¾“å‡º
10! = 3628800
```

### æ•°æ®å¤„ç†

```python
# è¯·æ±‚
"ä½¿ç”¨ Python ç”Ÿæˆå‰ 20 ä¸ªæ–æ³¢é‚£å¥‘æ•°"

# ç”Ÿæˆçš„ä»£ç 
def fibonacci(n):
    fib = [0, 1]
    for i in range(2, n):
        fib.append(fib[-1] + fib[-2])
    return fib

result = fibonacci(20)
print(f"å‰ 20 ä¸ªæ–æ³¢é‚£å¥‘æ•°: {result}")

# è¾“å‡º
å‰ 20 ä¸ªæ–æ³¢é‚£å¥‘æ•°: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181]
```

### ä¼šè¯æŒä¹…åŒ–

```python
# è¯·æ±‚ 1ï¼ˆä½¿ç”¨ session_id: "data-analysis"ï¼‰
"æ‰§è¡Œ Python: data = [1, 2, 3, 4, 5]"

# è¯·æ±‚ 2ï¼ˆç›¸åŒ session_idï¼‰
"æ‰§è¡Œ Python: import statistics; print(statistics.mean(data))"

# è¾“å‡º
3
```

## API é›†æˆ

### ç›´æ¥ API è°ƒç”¨

```bash
curl -X POST http://localhost:8000/agent/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "æ‰§è¡Œ Python: print(sum(range(100)))",
    "tools": ["python_executor"],
    "mode": "standard"
  }'
```

### å·¥å…·å‚æ•°

```json
{
  "tool": "python_executor",
  "parameters": {
    "code": "print('ä½ å¥½')",
    "session_id": "å¯é€‰çš„ä¼šè¯ID",
    "timeout_seconds": 30,
    "stdin": "å¯é€‰çš„è¾“å…¥æ•°æ®"
  }
}
```

## é…ç½®

### ç¯å¢ƒå˜é‡

```bash
# Python WASI è§£é‡Šå™¨è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
PYTHON_WASI_WASM_PATH=/opt/wasm-interpreters/python-3.11.4.wasm

# Agent Core åœ°å€ï¼ˆç”¨äº gRPC é€šä¿¡ï¼‰
AGENT_CORE_ADDR=agent-core:50051
```

### èµ„æºé™åˆ¶é…ç½®

#### åœ¨ä»£ç ä¸­ï¼ˆrust/agent-core/src/wasi_sandbox.rsï¼‰

```rust
// å…³é”®ï¼šè¿™äº›å€¼å¿…é¡»è®¾ç½®æ‰èƒ½ä½¿ Python WASM å·¥ä½œï¼
pub fn with_config(app_config: &Config) -> Result<Self> {
    // ...
    Ok(Self {
        // ...
        // Python WASM éœ€è¦æ›´å¤§çš„è¡¨é™åˆ¶ï¼ˆ5413+ å…ƒç´ ï¼‰
        table_elements_limit: 10000,  // å¿…é¡» â‰¥ 5413 æ‰èƒ½è¿è¡Œ Python
        instances_limit: 10,           // å¿…é¡» â‰¥ 4
        tables_limit: 10,              // å¿…é¡» â‰¥ 4
        memories_limit: 4,             // å¿…é¡» â‰¥ 2
    })
}
```

#### ç¯å¢ƒå˜é‡ï¼ˆdocker-compose.ymlï¼‰

```yaml
agent-core:
  environment:
    - WASI_MEMORY_LIMIT_MB=512      # Python æ‰§è¡Œçš„å†…å­˜
    - WASI_TIMEOUT_SECONDS=60        # æœ€å¤§æ‰§è¡Œæ—¶é—´
    - PYTHON_WASI_WASM_PATH=/opt/wasm-interpreters/python-3.11.4.wasm

llm-service:
  environment:
    - PYTHON_WASI_WASM_PATH=/opt/wasm-interpreters/python-3.11.4.wasm
    - AGENT_CORE_ADDR=agent-core:50051
```

## å®‰å…¨æ¨¡å‹

### æ²™ç®±ä¿è¯

| åŠŸèƒ½              | çŠ¶æ€      | æè¿°                                |
| ----------------- | --------- | ----------------------------------- |
| **å†…å­˜éš”ç¦»**      | âœ… å¼ºåˆ¶æ‰§è¡Œ | æ¯æ¬¡æ‰§è¡Œçš„ç‹¬ç«‹çº¿æ€§å†…å­˜ç©ºé—´           |
| **ç½‘ç»œè®¿é—®**      | âŒ é˜»æ­¢    | æœªæˆäºˆç½‘ç»œåŠŸèƒ½                       |
| **æ–‡ä»¶ç³»ç»Ÿ**      | ğŸ”’ åªè¯»    | é™åˆ¶ä¸ºç™½åå•è·¯å¾„                     |
| **è¿›ç¨‹ç”Ÿæˆ**      | âŒ é˜»æ­¢    | æ— æ³•åˆ›å»ºå­è¿›ç¨‹                       |
| **èµ„æºé™åˆ¶**      | âœ… å¼ºåˆ¶æ‰§è¡Œ | å†…å­˜ã€CPU å’Œæ—¶é—´é™åˆ¶                 |
| **ç³»ç»Ÿè°ƒç”¨**      | âŒ é˜»æ­¢    | æ— æ³•è®¿é—®ä¸»æœºç³»ç»Ÿè°ƒç”¨                 |

### ä¸ºä»€ä¹ˆé€‰æ‹© WASIï¼Ÿ

1. **çœŸæ­£éš”ç¦»**ï¼šWebAssembly æä¾›ç¡¬ä»¶çº§éš”ç¦»
2. **ç¡®å®šæ€§**ï¼šç›¸åŒä»£ç åœ¨è·¨å¹³å°äº§ç”Ÿç›¸åŒç»“æœ
3. **èµ„æºæ§åˆ¶**ï¼šå¯¹å†…å­˜å’Œ CPU ä½¿ç”¨çš„ç»†ç²’åº¦æ§åˆ¶
4. **æ— æ³•é€ƒé€¸**ï¼šå³ä½¿ä½¿ç”¨æ¶æ„ä»£ç ä¹Ÿæ— æ³•çªç ´æ²™ç®±
5. **è¡Œä¸šæ ‡å‡†**ï¼šè¢« Cloudflare Workersã€Fastly ç­‰ä½¿ç”¨

## æ”¯æŒçš„ Python åŠŸèƒ½

### âœ… å®Œå…¨æ”¯æŒ

- æ‰€æœ‰ Python 3.11 è¯­æ³•å’ŒåŠŸèƒ½
- æ ‡å‡†åº“æ¨¡å—ï¼š
  - `math`ã€`statistics`ã€`random`
  - `json`ã€`csv`ã€`xml`
  - `datetime`ã€`calendar`ã€`time`
  - `re`ã€`string`ã€`textwrap`
  - `collections`ã€`itertools`ã€`functools`
  - `hashlib`ã€`base64`ã€`binascii`
  - `decimal`ã€`fractions`
  - `pathlib`ã€`os.path`ï¼ˆåªè¯»ï¼‰

### âš ï¸ æœ‰é™æ”¯æŒ

- `io`ï¼šä»…å†…å­˜æ“ä½œ
- `sqlite3`ï¼šä»…å†…å­˜æ•°æ®åº“
- æ–‡ä»¶æ“ä½œï¼šå¯¹ `/tmp` çš„åªè¯»è®¿é—®

### âŒ ä¸æ”¯æŒ

- ç½‘ç»œæ“ä½œï¼ˆ`requests`ã€`urllib`ã€`socket`ï¼‰
- åŒ…å®‰è£…ï¼ˆ`pip install`ï¼‰
- åŸç”Ÿæ‰©å±•ï¼ˆC æ¨¡å—ï¼‰
- GUI åº“ï¼ˆ`tkinter`ã€`pygame`ï¼‰
- å¤šè¿›ç¨‹/å¤šçº¿ç¨‹
- ç³»ç»Ÿæ“ä½œï¼ˆ`subprocess`ã€`os.system`ï¼‰

## æ€§èƒ½ç‰¹å¾

| æ“ä½œ                        | æ—¶é—´   | å†…å­˜ |
| --------------------------- | ------ | ---- |
| è§£é‡Šå™¨åŠ è½½ï¼ˆé¦–æ¬¡ï¼‰          | ~500ms | 20MB |
| è§£é‡Šå™¨åŠ è½½ï¼ˆç¼“å­˜ï¼‰          | ~50ms  | 0MB  |
| ç®€å•æ‰“å°                    | ~100ms | 50MB |
| é˜¶ä¹˜(1000)                  | ~150ms | 55MB |
| æ’åº 10,000 ä¸ªæ•°å­—          | ~200ms | 60MB |
| å¤„ç† 1MB JSON               | ~300ms | 80MB |

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. "Failed to instantiate WASM module: table minimum size of 5413 elements exceeds table limits"

**åŸå› **ï¼šWebAssembly è¡¨é™åˆ¶å¯¹äº Python WASM å¤ªå°ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šæ›´æ–° `rust/agent-core/src/wasi_sandbox.rs`ï¼š

```rust
table_elements_limit: 10000,  // ä»é»˜è®¤ 1024 å¢åŠ 
```

ç„¶åé‡æ–°æ„å»ºï¼š`docker compose build agent-core`

#### 2. "Python WASI interpreter not found"

**åŸå› **ï¼šæœªä¸‹è½½ Python WASM æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ä¸‹è½½è§£é‡Šå™¨
./scripts/setup_python_wasi.sh

# éªŒè¯å…¶å­˜åœ¨ï¼ˆåº”çº¦ 20MBï¼‰
ls -lh wasm-interpreters/python-3.11.4.wasm
```

#### 3. "can't open file '//import sys; exec(sys.stdin.read())': [Errno 44] No such file or directory"

**åŸå› **ï¼šPython WASM çš„ argv æ ¼å¼ä¸æ­£ç¡®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ `python_wasi_executor.py` ä½¿ç”¨æ­£ç¡®çš„ argvï¼š

```python
"argv": ["python", "-c", "import sys; exec(sys.stdin.read())"],  # æ³¨æ„ï¼šargv[0] å¿…é¡»æ˜¯ "python"
```

#### 4. "Execution timeout"

**åŸå› **ï¼šPython ä»£ç æ‰§è¡Œæ—¶é—´è¶…è¿‡è¶…æ—¶é™åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# åœ¨è¯·æ±‚ä¸­å¢åŠ è¶…æ—¶ï¼ˆæœ€å¤§ 60 ç§’ï¼‰
{
  "code": "long_running_code()",
  "timeout_seconds": 60
}
```

#### 5. "Memory limit exceeded"

**åŸå› **ï¼šPython ä»£ç ä½¿ç”¨çš„å†…å­˜è¶…è¿‡åˆ†é…çš„å†…å­˜ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨ç¯å¢ƒå˜é‡ä¸­å¢åŠ å†…å­˜é™åˆ¶ï¼š

```bash
# åœ¨ docker-compose.yml çš„ agent-core ä¸­
environment:
  - WASI_MEMORY_LIMIT_MB=512  # ä» 256 å¢åŠ 
```

#### 6. "Module not found"

**åŸå› **ï¼šå°è¯•å¯¼å…¥å¤–éƒ¨åŒ…ï¼ˆnumpyã€pandas ç­‰ï¼‰ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä»… Python æ ‡å‡†åº“å¯ç”¨ã€‚å¤–éƒ¨åŒ…å¿…é¡»ä½¿ç”¨ stdlib é‡æ–°å®ç°ã€‚

#### 7. "WASI execution error" æ— è¯¦ç»†ä¿¡æ¯

**åŸå› **ï¼šå„ç§é—®é¢˜ - æ£€æŸ¥ agent-core æ—¥å¿—ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥è¯¦ç»†æ—¥å¿—
docker compose logs agent-core --tail 100 | grep -E "WASI|Python|code_executor"

# åœ¨ docker-compose.yml ä¸­å¯ç”¨è°ƒè¯•æ—¥å¿—
environment:
  - RUST_LOG=debug,shannon_agent_core::wasi_sandbox=debug
```

## æœ€ä½³å®è·µ

1. **ä¿æŒä»£ç ç®€å•**ï¼šå¤æ‚æ“ä½œä¼šå¢åŠ æ‰§è¡Œæ—¶é—´
2. **æ˜æ™ºä½¿ç”¨ä¼šè¯**ï¼šä¼šè¯ä¼šæ¶ˆè€—å†…å­˜ - å®Œæˆåæ¸…ç†
3. **å¤„ç†è¶…æ—¶**ï¼šé•¿æ—¶é—´è®¡ç®—åº”åˆ†è§£ä¸ºæ­¥éª¤
4. **æœ€å°åŒ–å¯¼å…¥**ï¼šæ¯æ¬¡å¯¼å…¥éƒ½ä¼šå¢åŠ å¼€é”€
5. **æ‰¹é‡æ“ä½œ**ï¼šåˆ†å—å¤„ç†æ•°æ®ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½

## ä¸æ›¿ä»£æ–¹æ¡ˆçš„æ¯”è¾ƒ

| åŠŸèƒ½              | Shannon WASI | Docker å®¹å™¨  | AWS Lambda  | Google Colab |
| ----------------- | ------------ | ------------ | ----------- | ------------ |
| **å®‰å…¨æ€§**        | â­â­â­â­â­        | â­â­â­          | â­â­â­â­        | â­â­â­          |
| **å¯åŠ¨æ—¶é—´**      | 50-100ms     | 1-5s         | 100-500ms   | 5-10s        |
| **å†…å­˜å¼€é”€**      | 50MB         | 200MB+       | 128MB+      | 1GB+         |
| **åŒ…æ”¯æŒ**        | ä»…æ ‡å‡†åº“     | å®Œæ•´         | å®Œæ•´        | å®Œæ•´         |
| **ç½‘ç»œè®¿é—®**      | å¦           | æ˜¯           | æ˜¯          | æ˜¯           |
| **æˆæœ¬**          | æœ€å°         | ä¸­ç­‰         | æŒ‰è¯·æ±‚è®¡è´¹  | å…è´¹/ä»˜è´¹    |
| **ç¡®å®šæ€§**        | æ˜¯           | å¦           | å¤§éƒ¨åˆ†      | å¦           |

## æœªæ¥è·¯çº¿å›¾

### è®¡åˆ’çš„å¢å¼ºåŠŸèƒ½

1. **åŒ…æ”¯æŒ**ï¼šé€šè¿‡ Pyodide é¢„ç¼–è¯‘ NumPyã€Pandas
2. **å¤šè¯­è¨€**ï¼šJavaScriptï¼ˆQuickJSï¼‰ã€Rubyï¼ˆruby.wasmï¼‰
3. **è°ƒè¯•**ï¼šé€æ­¥è°ƒè¯•æ”¯æŒ
4. **å¯è§†åŒ–**ï¼šé€šè¿‡ base64 å›¾åƒè¾“å‡º Matplotlib
5. **åˆ†å¸ƒå¼æ‰§è¡Œ**ï¼šç”¨äºå¤§å‹ä»»åŠ¡çš„å¤šèŠ‚ç‚¹æ‰§è¡Œ

## æŠ€æœ¯ç»†èŠ‚

### è§£é‡Šå™¨ï¼šCPython 3.11.4

- **æ¥æº**ï¼š[VMware WebAssembly Language Runtimes](https://github.com/vmware-labs/webassembly-language-runtimes)
- **å¤§å°**ï¼š20MB å‹ç¼©
- **Python ç‰ˆæœ¬**ï¼š3.11.4
- **æ„å»ºæ—¥æœŸ**ï¼š2023-07-14
- **å…¼å®¹æ€§**ï¼š100% CPython å…¼å®¹

### WASI è¿è¡Œæ—¶ï¼šWasmtime

- **ç‰ˆæœ¬**ï¼šæœ€æ–°ç¨³å®šç‰ˆ
- **åŠŸèƒ½**ï¼šWASI Preview 1
- **å®‰å…¨æ€§**ï¼šåŸºäºèƒ½åŠ›çš„å®‰å…¨æ¨¡å‹
- **æ€§èƒ½**ï¼šæ¥è¿‘åŸç”Ÿæ‰§è¡Œé€Ÿåº¦

## è·å–å¸®åŠ©

### èµ„æº

- [WebAssembly è§„èŒƒ](https://webassembly.github.io/spec/)
- [WASI æ–‡æ¡£](https://wasi.dev/)
- [Python WASM æŒ‡å—](https://github.com/vmware-labs/webassembly-language-runtimes/tree/main/python)
- [Shannon æ–‡æ¡£](https://github.com/Kocoro-lab/Shannon)

### æ”¯æŒ

- GitHub Issuesï¼š[shannon/issues](https://github.com/Kocoro-lab/shannon/issues)
- æ–‡æ¡£ï¼š[docs/](../docs/)

---

*æœ€åæ›´æ–°ï¼š2025 å¹´ 1 æœˆ*

